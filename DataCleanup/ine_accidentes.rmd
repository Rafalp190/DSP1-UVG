---
title: "INE Accidentes Automovilísticos"
author: "RL, JB y AV"
date: "July 29, 2018"
output: flexdashboard::flex_dashboard
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
# Load Packages
require("plyr")
require("dplyr")
if (!require("flexdashboard"))    {install.packages("flexdashboard");   library(flexdashboard)}

```
Overview
=====================================  

### Descripción 
El [instituto nacional de estadística de Guatemala](https://www.ine.gob.gt/), provee una base de datos de Accidentes de tránsito desde el año 2009 al año 2017 ([consultado: Julio, 2018)](https://www.ine.gob.gt/index.php/estadisticas-continuas/accidentes-de-transito)). Como parte de su módulo de estadísticas continuas. Esta base de datos presenta información de Hechos de Tránsito (**HT**), Vehiculos involucrados (**VI**) y lesionados y fallecidos (**FL**). Sin embargo esta información se encuentra fragmentada en distintos documentos que han sido agregados anualmente. Estos documentos se encuentran en distintos formatos y contienen variables diferentes. El objetivo primario de este acercamiento de limpieza de bases de datos es la unificación de los tres tipos de bases de datos para obtener una base centralizada facil de acceder para utilizar en futuros análisis. A continuación se desglosa el procedimiento que se siguió para realizar esta unificación, con justificaciones para las variables descartadas y las codificaciones realizadas. 


### Observación Inicial
Se realizó una observación inicial de las bases de datos para encontrar los puntos importantes a tratar para facilitar la unificación. 
Después de descargar los archivos observamos varios problemas que hay que tratar para limpiar los datos. A continuación, se lista cada uno de ellos.  

- Todos los archivos de los distintos años están separados. 
- El primer problema que observamos es que los datos están en distintos formatos (SPSS, xlsx y xls).
- Nombres de variables con tildes y caracteres especiales.
- Variables categóricas codificadas con variables numéricos al igual que los valores faltantes
- Bases de datos de 2009 con nombres diferentes a las bases de datos de años más nuevos (diferente formato).
- Variables binarias codificadas con 1,2
- Valores faltantes en todas las columnas
- Columnas de Día/mes/semana/fecha separadas  

Para facilitar el proceso de acceso a la información se decidió convertir todos los archivos a formato CSV. Despues se procedió a colocarlos en un repositorio en [github](https://github.com/Rafalp190/DSP1-UVG). Esto permite acceder a la información de una forma constante mientras exista el repositorio. Se decidió tomar este paso para lidiar con un error de programación de la página del INE. En donde cada vez que se descarga un archivo se genera un archivo con el nombre *codigo_hash.extension*. Notamos que cada vez que se descarga el mismo archivo el codigo hash cambia. Haciendo la automatización de la descarga imposible. El primer *snippet* de código muestra como se descargaron los archivos del repositorio de github.  


Hechos de Tránsito
=====================================================================

Para facilitar el proceso de acceso a la información se decidió convertir todos los archivos a formato CSV. Despues se procedió a colocarlos en un repositorio en [github](https://github.com/Rafalp190/DSP1-UVG). Esto permite acceder a la información de una forma constante mientras exista el repositorio. Se decidió tomar este paso para lidiar con un error de programación de la página del INE. En donde cada vez que se descarga un archivo se genera un archivo con el nombre *codigo_hash.extension*. Notamos que cada vez que se descarga el mismo archivo el codigo hash cambia. Haciendo la automatización de la descarga imposible. El primer *snippet* de código muestra como se descargaron los archivos del repositorio de github.  

```{r downloads}
## Read all HT dataframes by year
ht09 <- read.csv("https://raw.githubusercontent.com/Rafalp190/DSP1-UVG/master/DataCleanup/Data/09HT.csv")
ht10 <- read.csv("https://raw.githubusercontent.com/Rafalp190/DSP1-UVG/master/DataCleanup/Data/10HT.csv")
ht11 <- read.csv("https://raw.githubusercontent.com/Rafalp190/DSP1-UVG/master/DataCleanup/Data/11HT.csv")
ht12 <- read.csv("https://raw.githubusercontent.com/Rafalp190/DSP1-UVG/master/DataCleanup/Data/12HT.csv")
ht13 <- read.csv("https://raw.githubusercontent.com/Rafalp190/DSP1-UVG/master/DataCleanup/Data/13HT.csv")
ht14 <- read.csv("https://raw.githubusercontent.com/Rafalp190/DSP1-UVG/master/DataCleanup/Data/14HT.csv")
ht15 <- read.csv("https://raw.githubusercontent.com/Rafalp190/DSP1-UVG/master/DataCleanup/Data/15HT.csv")
ht16 <- read.csv("https://raw.githubusercontent.com/Rafalp190/DSP1-UVG/master/DataCleanup/Data/16HT.csv")
ht17 <- read.csv("https://raw.githubusercontent.com/Rafalp190/DSP1-UVG/master/DataCleanup/Data/17HT.csv")
```

Después de descargar las bases de datos se procedió a unificarlas por pares. Uno de los primeros problemas encontrados al tratar de unificar por pares fueron los diferentes nombres de variables. Para mas detalles sobre las variables y los nombres de variables seleccionados pueden consultar el [libro de códigos](https://github.com/Rafalp190/DSP1-UVG).
```{r}
## Determine ColNames to use for Joins
colnames(ht09)
colnames(ht10)
ht09$num_hecho <- NULL

oldNamesHT09 <- colnames(ht09)
newNamesHT09 <- c(oldNamesHT09[1],oldNamesHT09[2], "ano_ocu", oldNamesHT09[4], oldNamesHT09[5], oldNamesHT09[6], oldNamesHT09[7], oldNamesHT09[8], oldNamesHT09[9],
                 "grupo_eda_pil", oldNamesHT09[11], "tipo_veh", "color_veh", "modelo_veh", "causa_acc")

ht09 <- ht09 %>% rename_at(vars(oldNamesHT09), ~ newNamesHT09)

oldNamesHT10 <- colnames(ht10)
newNamesHT10 <- c(oldNamesHT10[1], oldNamesHT10[2], oldNamesHT10[3], oldNamesHT10[4], oldNamesHT10[5], oldNamesHT10[6], oldNamesHT10[7],
                  oldNamesHT10[8], oldNamesHT10[9], oldNamesHT10[10], "tipo_veh", "color_veh", "modelo_veh", "causa_acc")
ht10 <- ht10 %>% rename_at(vars(oldNamesHT10), ~ newNamesHT10)
```


El siguiente paso consistió en la conversion de las distintas variables con el mismo nombre al mismo tipo. (Nota, esto es necesario por la forma en la que *read.csv* interpreta los tipos de cada variable).
```{r}
ht09$dia_sem_ocu <- as.factor(ht09$dia_sem_ocu)
ht10$dia_sem_ocu <- as.factor(ht10$dia_sem_ocu)
ht09$hora_ocu <- as.character(ht09$hora_ocu)
ht10$hora_ocu <- as.character(ht10$hora_ocu)
ht09$edad_pil <- as.numeric(ht09$edad_pil)
ht10$edad_pil <- as.numeric(ht10$edad_pil)
ht10$depto_ocu <- as.character(ht10$depto_ocu)
ht09$depto_ocu <- as.character(ht09$depto_ocu)
ht10$areag_ocu <- as.numeric(ht10$areag_ocu)
ht09$areag_ocu <- as.numeric(ht09$areag_ocu)
```
Seguido de la unificación de las bases de datos por medio de un **full_join**.

```{r,message=T, warning=FALSE}
## Join between HT09 and HT10
ht09$ano_ocu <- 2009
ht10$ano_ocu <- 2010
ht <- full_join(ht09,ht10)
#Cleanup
rm(ht09)
rm(ht10)

```
A continación se desglosa el mismo proceso para todas las bases de datos. En donde en cada paso se tuvo que hacer un poco de limpieza de los valores y de los nombres de variables de la misma forma que se realizó en la parte descrita anteriormente.
```{r, message=T, warning=FALSE}
ht11$num_hecho <- NULL

oldNamesHT11 <- colnames(ht11)
newNamesHT11 <- c(oldNamesHT11[1], oldNamesHT11[2], oldNamesHT11[3], oldNamesHT11[4], oldNamesHT11[5], oldNamesHT11[6], oldNamesHT11[7],
                  oldNamesHT11[8], oldNamesHT11[9], oldNamesHT11[10], "grupo_eda_pil", "mayor_men", oldNamesHT11[13],
                  "tipo_veh", "marca_veh", "color_veh", "modelo_veh", "causa_acc")
ht11 <- ht11 %>% rename_at(vars(oldNamesHT11), ~ newNamesHT11)



ht11$hora_ocu <- as.character(ht11$hora_ocu)
ht11$areag_ocu <- as.numeric(ht11$areag_ocu)
ht11$edad_pil <- as.numeric(ht11$edad_pil)
ht11$zona_ocu <- as.numeric(ht11$zona_ocu)

## Join between HT and HT11
ht11$ano_ocu <- 2011
ht <- full_join(ht, ht11)
rm(ht11)
ht12$num_hecho <- NULL

colnames(ht12) <- c("dia_ocu", "mes_ocu", "dia_sem_ocu", "hora_ocu", "depto_ocu", "muni_ocu", "areag_ocu", "zona_ocu", "sexo_pil", "edad_pil",
                    "grupo_eda_pil", "mayor_men", "estado_pil", "tipo_veh", "color_veh", "causa_acc")

ht12$hora_ocu <- as.character(ht12$hora_ocu)
ht12$areag_ocu <- as.numeric(ht12$areag_ocu)
ht12$edad_pil <- as.numeric(ht12$edad_pil)
ht12$zona_ocu <- as.numeric(ht12$zona_ocu)
ht12$muni_ocu <- as.numeric(ht12$muni_ocu)

## Join between HT and HT12
ht12$ano_ocu <- 2012
ht <- full_join(ht, ht12)
rm(ht12)
ht13$num_hecho <- NULL

colnames(ht13) <- c("dia_ocu", "mes_ocu", "dia_sem_ocu", "hora_ocu","g_hora", "depto_ocu", "muni_ocu", "areag_ocu", "zona_ocu", "sexo_pil", "edad_pil",
                    "grupo_eda_pil", "mayor_men", "tipo_veh", "color_veh","modelo_veh", "causa_acc", "marca_veh", "estado_pil")

ht13$hora_ocu <- as.character(ht13$hora_ocu)
ht13$areag_ocu <- as.numeric(ht13$areag_ocu)
ht13$edad_pil <- as.numeric(ht13$edad_pil)
ht13$zona_ocu <- as.numeric(ht13$zona_ocu)
ht13$muni_ocu <- as.numeric(ht13$muni_ocu)


## Join between HT and HT13
ht13$ano_ocu <- 2013
ht <- full_join(ht, ht13)
rm(ht13)

ht14$num_correlativo <- NULL
ht14$corre_base <- NULL

colnames(ht14) <- c("dia_ocu", "dia_sem_ocu", "hora_ocu","g_hora","mes_ocu", "depto_ocu", "muni_ocu", "zona_ocu","areag_ocu", "sexo_pil", "edad_pil",
                    "grupo_eda_pil", "mayor_men","estado_pil", "tipo_veh", "modelo_veh", "color_veh", "marca_veh", "causa_acc")

ht14$hora_ocu <- as.character(ht14$hora_ocu)
ht14$areag_ocu <- as.numeric(ht14$areag_ocu)
ht14$edad_pil <- as.numeric(ht14$edad_pil)
ht14$zona_ocu <- as.numeric(ht14$zona_ocu)
ht14$muni_ocu <- as.numeric(ht14$muni_ocu)


## Join between HT and HT14
ht14$ano_ocu <- 2014
ht <- full_join(ht, ht14)
rm(ht14)


ht15$núm_corre <- NULL
ht15$g_edad_60ymás <- NULL
ht15$g_edad_80ymás <- NULL
ht15$g_hora_5 <- NULL
ht15$g_hora <- NULL
ht15$edad_quinquenales <- NULL
ht15$g_modelo_veh <- NULL


colnames(ht15) <- c("ano_ocu", "mes_ocu", "dia_ocu","dia_sem_ocu", "hora_ocu", "depto_ocu", "muni_ocu", "areag_ocu", "zona_ocu", "sexo_pil", "edad_pil",
                     "mayor_men","estado_pil", "tipo_veh", "marca_veh", "color_veh", "modelo_veh", "causa_acc")

ht15$hora_ocu <- as.character(ht15$hora_ocu)
ht15$areag_ocu <- as.numeric(ht15$areag_ocu)
ht15$edad_pil <- as.numeric(ht15$edad_pil)
ht15$zona_ocu <- as.numeric(ht15$zona_ocu)
ht15$muni_ocu <- as.numeric(ht15$muni_ocu)


# Desde el anio 2015 decidieron codificar las variables, consideramos que es más eficiente a nivel práctico codificar las variables de mes y dia de 
# la semana a variables numericas

# mes ocurrencia recodificacion
ht$mes_ocu <- mapvalues(ht$mes_ocu, from=c("Enero", "Febrero", "Marzo", "Abril", "Mayo", "Junio", "Julio", "Agosto", "Septiembre", "Septiemre", "Octubre"
                           , "Noviembre", "Diciembre"), to=c(1,2,3,4,5,6,7,8,9,9,10,11,12))
ht$mes_ocu <- as.numeric(ht$mes_ocu)

# dia semana ocurrencia recodificacion
ht$dia_sem_ocu <- mapvalues(ht$dia_sem_ocu, from=c("Lunes", "Martes", "Miercoles", "Miércoles", "Jueves", "Viernes", "Sabado", "Sábado", "Domingo")
                             , to=c(1,2,3,3,4,5,6,6,7))
ht$dia_sem_ocu <- as.numeric(ht$dia_sem_ocu)

# Departamento recodificacion
ht15$depto_ocu <- mapvalues(ht15$depto_ocu, from=c(1:22), to=c("Guatemala","El progreso","Sacatepéquez","Chimaltenango","Escuintla","Santa rosa","Sololá","Totonicapán","Quetzaltenango","Suchitepéquez",
                                                               "Retalhuleu","San Marcos","Huehuetenango","Quiche","Baja Verapaz","Alta Verapaz","Peten","Izabal","Zacapa","Chiquimula","Jalapa",
                                                               "Jutiapa"))
# Sexo Piloto recodificacion
ht$sexo_pil <- mapvalues(ht$sexo_pil, from=c("Hombre", "Mujer", "Ignorado"), to=c(1,2,9))
ht$sexo_pil <- as.numeric(ht$sexo_pil)

# Estado Piloto recodificacion
ht$estado_pil <- mapvalues(ht$estado_pil, from=c("Bajo efectos de alcohol", "Ebrio", "Normal", "Ignorado"), to=c(2,2,1,9))
ht$estado_pil <- as.numeric(ht$estado_pil)

# Tipo Vehiculo recodificacion

tipovehLabels <- as.vector(as.data.frame(table(as.factor(ht$tipo_veh)))$Var1)
ht$tipo_veh <- mapvalues(ht$tipo_veh, from=tipovehLabels, to=c(1,1,18,17,7,12,6,5,5,2,2,15,15,16,99,8,9,14,4,14,11,3,3,10,13))
ht$tipo_veh <- as.numeric(ht$tipo_veh)

#Color vehiculo recodificacion (se queda como character)
ht15$color_veh <-  mapvalues(ht15$color_veh, 
                         from=c(1:17,99), to=c("Rojo", "Blanco","Azul", "Gris", "Negro", "Verde", "Amarillo",
                                               "Celeste", "Corinto", "Café", "Beige", "Turquesa", "Marfil", "Anaranjado"
                                               , "Aqua", "Morado", "Rosado", "Ignorado"))

# Modelo Vehiculo recodificacion
ht15$modelo_veh <- mapvalues(ht15$modelo_veh, from=9999, to="Ignorado")

# Causa acc recodificacion

causaAccLabels <- as.vector(as.data.frame(table(as.factor(ht$causa_acc)))$Var1)
ht$causa_acc <- mapvalues(ht$causa_acc, 
                          from=causaAccLabels, to=c("Atropello", "Atropello", "Caída", "Caída", "Choque", "Colisión", "Colisión", "Catástrofe"
                                                    , "Empotro", "Ignorado", "Vuelco", "Vuelco"))
ht15$causa_acc <- mapvalues(ht15$causa_acc, 
                            from=c(1:12,99), to=c("Colisión", "Choque", "Vuelco", "Caída","Atropello", "Perdida de control", "Colisión contra animal",
                                                  "Exceso de pasaje", "Asfalto mojado", "Exceso de velocidad", "Desperfectos mecánicos", "Incendio", "Ignorado"))

# Mayor menor recodificacion
ht$mayor_men <- mapvalues(ht$mayor_men, from=c("Mayor", "Menor", "Ignorado"), to=c(1,2,9))
ht$mayor_men <- as.numeric(ht$mayor_men)
ht15$marca_veh <- mapvalues(ht15$marca_veh, from=99, to="Ignorado")

## Join between HT and HT15
ht$g_hora <- NULL
ht <- full_join(ht, ht15)

rm(ht15)


ht16$núm_corre <- NULL
ht16$g_hora <- NULL
ht16$g_hora_5 <- NULL
ht16$g_modelo_veh <- NULL

colnames(ht16) <- c("dia_ocu", "ano_ocu", "hora_ocu", "mes_ocu", "dia_sem_ocu", "muni_ocu", "depto_ocu", "areag_ocu", "zona_ocu", "tipo_veh",
                    "marca_veh", "color_veh", "modelo_veh", "causa_acc")

ht16$hora_ocu <- as.character(ht16$hora_ocu)
ht16$areag_ocu <- as.numeric(ht16$areag_ocu)
ht16$zona_ocu <- as.numeric(ht16$zona_ocu)
ht16$muni_ocu <- as.numeric(ht16$muni_ocu)
ht16$depto_ocu <- mapvalues(ht16$depto_ocu, from=c(1:22), to=c("Guatemala","El progreso","Sacatepéquez","Chimaltenango","Escuintla","Santa rosa","Sololá","Totonicapán","Quetzaltenango","Suchitepéquez",
                                                               "Retalhuleu","San Marcos","Huehuetenango","Quiche","Baja Verapaz","Alta Verapaz","Peten","Izabal","Zacapa","Chiquimula","Jalapa",
                                                               "Jutiapa"))
ht16$color_veh <-  mapvalues(ht16$color_veh, 
                             from=c(1:17,99), to=c("Rojo", "Blanco","Azul", "Gris", "Negro", "Verde", "Amarillo",
                                                   "Celeste", "Corinto", "Café", "Beige", "Turquesa", "Marfil", "Anaranjado"
                                                   , "Aqua", "Morado", "Rosado", "Ignorado"))
ht16$modelo_veh <- mapvalues(ht16$modelo_veh, from=9999, to="Ignorado")
ht16$causa_acc <- mapvalues(ht16$causa_acc, 
                            from=c(1:12,99), to=c("Colisión", "Choque", "Vuelco", "Caída","Atropello", "Perdida de control", "Colisión contra animal",
                                                  "Exceso de pasaje", "Asfalto mojado", "Exceso de velocidad", "Desperfectos mecánicos", "Incendio", "Ignorado"))
ht16$marca_veh <- mapvalues(ht16$marca_veh, from=999, to="Ignorado")



## Join between HT and HT16
ht <- full_join(ht,ht16)
rm(ht16)

ht17$núm_corre <- NULL
ht17$g_hora <- NULL
ht17$g_hora_5 <- NULL
ht17$g_modelo_veh <- NULL

colnames(ht17) <- c("ano_ocu", "dia_ocu", "hora_ocu", "mes_ocu", "dia_sem_ocu", "muni_ocu", "depto_ocu", "zona_ocu", "tipo_veh", "marca_veh"
                    ,"color_veh", "modelo_veh", "causa_acc")


ht17$hora_ocu <- as.character(ht17$hora_ocu)
ht17$zona_ocu <- as.numeric(ht17$zona_ocu)
ht17$muni_ocu <- as.numeric(ht17$muni_ocu)
ht17$depto_ocu <- mapvalues(ht17$depto_ocu, from=c(1:22), to=c("Guatemala","El progreso","Sacatepéquez","Chimaltenango","Escuintla","Santa rosa","Sololá","Totonicapán","Quetzaltenango","Suchitepéquez",
                                                               "Retalhuleu","San Marcos","Huehuetenango","Quiche","Baja Verapaz","Alta Verapaz","Peten","Izabal","Zacapa","Chiquimula","Jalapa",
                                                               "Jutiapa"))
ht17$color_veh <-  mapvalues(ht17$color_veh, 
                             from=c(1:17,99), to=c("Rojo", "Blanco","Azul", "Gris", "Negro", "Verde", "Amarillo",
                                                   "Celeste", "Corinto", "Café", "Beige", "Turquesa", "Marfil", "Anaranjado"
                                                   , "Aqua", "Morado", "Rosado", "Ignorado"))
ht17$modelo_veh <- mapvalues(ht17$modelo_veh, from=9999, to="Ignorado")
ht17$causa_acc <- mapvalues(ht17$causa_acc, 
                            from=c(1:12,99), to=c("Colisión", "Choque", "Vuelco", "Caída","Atropello", "Perdida de control", "Colisión contra animal",
                                                  "Exceso de pasaje", "Asfalto mojado", "Exceso de velocidad", "Desperfectos mecánicos", "Incendio", "Ignorado"))
ht17$marca_veh <- mapvalues(ht17$marca_veh, from=999, to="Ignorado")


## Join between HT and HT17
ht <- full_join(ht, ht17)
rm(ht17)
```

Para concluir la unificación de la base de datos de hechos de tránsito se guardó como archivo CSV en la carpeta de **Results**
```{r}
ht$grupo_eda_pil <- NULL
write.csv(ht, "Results/ht09_17.csv", row.names = F)
head(ht)
```

Fallecidos y Lesionados
=====================================
FOO

Vehiculos Involucrados
=====================================
Para el area el area de vehiculos involucrados no fue tan complicada la pulida de datos, pero mas que todo tediosa. Cada año se agregaban campos que se pueden calcular , esto los vuelve redundantes.

Año 2010: se agrego una columna con el año del caso individual
```{r}
#renombrando vi 10
new10 <- read.csv("https://raw.githubusercontent.com/Rafalp190/DSP1-UVG/master/DataCleanup/Data/10VI.csv")
new12 <- read.csv("https://raw.githubusercontent.com/Rafalp190/DSP1-UVG/master/DataCleanup/Data/12VI.csv")
new13 <- read.csv("https://raw.githubusercontent.com/Rafalp190/DSP1-UVG/master/DataCleanup/Data/13VI.csv")
new14 <- read.csv("https://raw.githubusercontent.com/Rafalp190/DSP1-UVG/master/DataCleanup/Data/14VI.csv")
new15 <- read.csv("https://raw.githubusercontent.com/Rafalp190/DSP1-UVG/master/DataCleanup/Data/15VI.csv")
new16 <- read.csv("https://raw.githubusercontent.com/Rafalp190/DSP1-UVG/master/DataCleanup/Data/16VI.csv")
new17 <- read.csv("https://raw.githubusercontent.com/Rafalp190/DSP1-UVG/master/DataCleanup/Data/17VI.csv")

summary(new10)
colnames(new10) <- c("dia_ocu", "mes_ocu","dia_sem_ocu","hora_ocu","depto_ocu","areag_ocu","zona_ocu",
                   "sexo_pil","edad_pil","estado_pil","tipo_veh","color_veh","modelo_veh","causa_acc"
                   )
new10$ano_ocu <- 2010
```

Años 2012: Se quita la columna num_vehi ya que es solo un contador innecesario. Se agrega el año de occurencia
```{r}


summary(new12)
new12$num_vehí <- NULL
colnames(new12) <- c("dia_ocu", "mes_ocu","dia_sem_ocu","hora_ocu","depto_ocu","muni_ocu","areag_ocu",
                   "zona_ocu","sexo_pil","edad_pil","grupo_edad_pil","mayor_men","estado_pil","tipo_veh","color_veh",
                   "modelo_veh","causa_acc")
new12$ano_ocu <- 2012

```

Años 2013: Se quita la columna num_hecho ya que es solo un contador innecesario. Se agrega el año de occurencia
```{r}

#renombrando vi 13

summary(new13)
new13$num_hecho <- NULL
colnames(new13) <- c("dia_ocu", "mes_ocu","dia_sem_ocu","hora_ocu","depto_ocu","muni_ocu","areag_ocu",
                    "zona_ocu","sexo_pil","edad_pil","mayor_men","tipo_veh","color_veh","modelo_veh","causa_acc",
                    "marca_veh","grupo_edad_pil","estado_pil","grupo_mod_veh")
new13$ano_ocu <- 2013
```

Años 2014: Se quita la columna num_correlativo y corre_base ya que son innecesarios. Se agrega el año de occurencia y se renombran las columnas al estandard del grupo. 
```{r}

#renombrando vi 14

summary(new14)
new14$num_correlativo <- NULL
new14$corre_base <- NULL
colnames(new14) <- c("dia_ocu","dia_sem_ocu","hora_ocu","grupo_hor_ocu","mes_ocu","depto_ocu","muni_ocu",
                    "zona_ocu","areag_ocu","sexo_pil","edad_pil","grupo_eda_pil","mayor_men","estado_pil",
                    "tipo_veh","modelo_veh","color_veh","marca_veh","causa_acc")
new14$ano_ocu <- 2014
```

Años 2015: Se quita la columna núm_corre, g_hora, g_hora_5,g_edad_60ymás, g_edad_80ymás, edad_quinquenales y g_modelo_veh ya que son innecesarios. Se agrega el año de occurencia y se renombran las columnas al estandard del grupo. 
```{r}

#remombrado vi15

new15$núm_corre <- NULL
new15$g_hora <- NULL
new15$g_hora_5 <- NULL
new15$g_edad_60ymás <- NULL
new15$g_edad_80ymás <- NULL
new15$edad_quinquenales <-NULL
new15$g_modelo_veh <- NULL
summary(new15)
colnames(new15) <- c("mes_ocu", "dia_ocu","dia_sem_ocu","hora_ocu","depto_ocu","muni_ocu",
                    "areag_ocu", "zona_ocu","sexo_pil","edad_pil","mayor_men","estado_pil",
                    "tipo_veh","marca_veh","color_veh","modelo_veh","causa_acc")
new15$ano_ocu <- 2015
```

Años 2016: Se quita la columna núm_corre, g_hora, g_hora_5,g_edad_60ymás, g_edad_80ymás, edad_quinquenales y g_modelo_veh ya que son innecesarios. Se agrega el año de occurencia y se renombran las columnas al estandard del grupo. 
```{r}

#renombrando vi16

new16$año_ocu <- NULL
new16$num_corre <- NULL
new16$g_hora <- NULL
new16$g_hora_5 <- NULL
new16$g_edad_60ymás <- NULL
new16$g_edad_80ymás <- NULL
new16$edad_quinquenales <-NULL
new16$g_modelo_veh <- NULL
summary(new16)
colnames(new16) <- c("dia_ocu","hora_ocu","mes_ocu","dia_sem_ocu","muni_ocu","depto_ocu",
                     "areag_ocu","sexo_pil","zona_ocu","edad_pil","estado_pil","mayor_men",
                     "tipo_veh","marca_veh","color_veh","modelo_veh","causa_acc")
new16$ano_ocu <- 2016
```

Años 2017: Se quita la columna núm_corre, g_hora, g_hora_5,g_edad_60ymás, g_edad_80ymás, edad_quinquenales y g_modelo_veh ya que son innecesarios. Se agrega el año de occurencia y se renombran las columnas al estandard del grupo. 
```{r}

#renombrando vi17

new17$año_ocu <- NULL
new17$núm_corre <- NULL
new17$g_hora <- NULL
new17$g_hora_5 <- NULL
new17$g_edad_60ymás <- NULL
new17$g_edad_80ymás <- NULL
new17$edad_quinquenales <-NULL
new17$g_modelo_veh <- NULL
summary(new17)
colnames(new17) <- c("dia_ocu","hora_ocu","mes_ocu","dia_sem_ocu","muni_ocu","depto_ocu",
                     "zona_ocu","sexo_pil","edad_pil","estado_pil","mayor_men",
                     "tipo_veh","marca_veh","color_veh","modelo_veh","causa_acc")
new17$ano_ocu <- 2017


```

Se arreglan el tipo de de columas para que el full merge funcione
```{r}

#fixing types
#fixing types
new10$zona_ocu <- as.numeric(new10$zona_ocu)
new12$zona_ocu <- as.numeric(new12$zona_ocu)
new10$edad_pil <- as.numeric(new10$edad_pil)
new12$edad_pil <- as.numeric(new12$edad_pil)
new10$modelo_veh <- as.numeric(new10$modelo_veh)
new12$modelo_veh <- as.numeric(new12$modelo_veh)


#merging 
vi <- full_join(new10,new12)
vi$zona_ocu <- as.factor(vi$zona_ocu)
new13$zona_ocu <- as.factor(new13$zona_ocu)
vi$edad_pil <- as.factor(vi$edad_pil)
new13$edad_pil <- as.factor(new13$edad_pil)
vi$modelo_veh <- as.factor(vi$modelo_veh)
new13$modelo_veh <- as.factor(new13$mode)


vi <- full_join(vi, new13)
vi <- full_join(vi, new14)
vi$mes_ocu <- as.character(vi$mes_ocu)
new15$mes_ocu <- as.character(new15$mes_ocu)
vi$dia_sem_ocu <- as.character(vi$dia_sem_ocu)
new15$dia_sem_ocu <- as.character(new15$dia_sem_ocu)
vi$depto_ocu <- as.character(vi$depto_ocu)
new15$depto_ocu <- as.character(new15$depto_ocu)
vi$areag_ocu <- as.character(vi$areag_ocu)
new15$areag_ocu <- as.character(new15$areag_ocu)
vi$zona_ocu <- as.character(vi$zona_ocu)
new15$zona_ocu <- as.character(new15$zona_ocu)
vi$sexo_pil <- as.factor(vi$sexo_pil)
new15$sexo_pil <- as.factor(new15$sexo_pil)
vi$edad_pil <- as.numeric(vi$edad_pil)
new15$edad_pil <- as.numeric(new15$edad_pil)
vi$estado_pil <- as.character(vi$estado_pil)
new15$estado_pil <- as.character(new15$estado_pil)
vi$tipo_veh <- as.character(vi$tipo_veh)
new15$tipo_veh <- as.character(new15$tipo_veh)
vi$color_veh <- as.character(vi$color_veh)
new15$color_veh <- as.character(new15$color_veh)
vi$modelo_veh <- as.character(vi$modelo_veh)
new15$modelo_veh <- as.character(new15$modelo_veh)
vi$causa_acc <- as.character(vi$causa_acc)
new15$causa_acc <- as.character(new15$causa_acc)
vi$muni_ocu <- as.character(vi$muni_ocu)
new15$muni_ocu <- as.character(new15$muni_ocu)
vi$mayor_men <- as.character(vi$mayor_men)
new15$mayor_men <- as.character(new15$mayor_men)
vi$marca_veh <- as.character(vi$marca_veh)
new15$marca_veh <- as.character(new15$marca_veh)


vi <- full_join(vi,new15)
new16$mes_ocu <- as.character(new16$mes_ocu)
new16$dia_sem_ocu <- as.character(new16$dia_sem_ocu)
new16$depto_ocu <- as.character(new16$depto_ocu)
new16$areag_ocu <- as.character(new16$areag_ocu)
new16$zona_ocu <- as.character(new16$zona_ocu)
new16$sexo_pil <- as.factor(new16$sexo_pil)
new16$edad_pil <- as.numeric(new16$edad_pil)
new16$estado_pil <- as.character(new16$estado_pil)
new16$tipo_veh <- as.character(new16$tipo_veh)
new16$color_veh <- as.character(new16$color_veh)
new16$modelo_veh <- as.character(new16$modelo_veh)
new16$causa_acc <- as.character(new16$causa_acc)
new16$muni_ocu <- as.character(new16$muni_ocu)
new16$mayor_men <- as.character(new16$mayor_men)
new16$marca_veh <- as.character(new16$marca_veh)

vi <- full_join(vi, new16)
new17$mes_ocu <- as.character(new17$mes_ocu)
new17$dia_sem_ocu <- as.character(new17$dia_sem_ocu)
new17$depto_ocu <- as.character(new17$depto_ocu)
new17$zona_ocu <- as.character(new17$zona_ocu)
new17$sexo_pil <- as.factor(new17$sexo_pil)
new17$edad_pil <- as.numeric(new17$edad_pil)
new17$estado_pil <- as.character(new17$estado_pil)
new17$tipo_veh <- as.character(new17$tipo_veh)
new17$color_veh <- as.character(new17$color_veh)
new17$modelo_veh <- as.character(new17$modelo_veh)
new17$causa_acc <- as.character(new17$causa_acc)
new17$muni_ocu <- as.character(new17$muni_ocu)
new17$mayor_men <- as.character(new17$mayor_men)
new17$marca_veh <- as.character(new17$marca_veh)

vi <- full_join(vi, new17)




write.csv(vi, "Results/vi10_17.csv", row.names = F)

```

Base Unificada INE 2009-2017
=====================================
FOOa
